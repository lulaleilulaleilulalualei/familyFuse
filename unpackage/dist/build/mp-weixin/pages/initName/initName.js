(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/initName/initName"],{"1a09":function(n,i,t){"use strict";(function(n){t("c5ea"),t("921b");a(t("66fd"));var i=a(t("8f7f"));function a(n){return n&&n.__esModule?n:{default:n}}n(i.default)}).call(this,t("543d")["createPage"])},"56dc":function(n,i,t){"use strict";t.r(i);var a=t("6230"),e=t.n(a);for(var o in a)"default"!==o&&function(n){t.d(i,n,function(){return a[n]})}(o);i["default"]=e.a},6230:function(n,i,t){"use strict";(function(n){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var t={data:function(){return{nameXing:"",userName:"",userDuty:"",userTel:"",userCard:"",userInfo:null,userImg:"",union_list:[],fromType:"",id:"",jobsArr:[],jobIdx:null,typeIdx:""}},onLoad:function(n){this.fromType=n.from,"edit"==n.from&&n.id&&(this.id=n.id),this.userInfo=this.$userInfo,this.getJobs()},methods:{toAddOthInit:function(){this.union_list.push({union$name:"union$name",union$duty:"union$duty",union$tel:"union$tel",union$idCard:"union$idCard",union_idx:null,union_img:"",union_name:"",union_duty:"",union_tel:"",union_idCard:""})},bindPickerChange:function(n){var i=this,t=n.detail.value;999==this.typeIdx?(this.jobIdx=t,this.userDuty=this.jobsArr[t].id,this.typeIdx=""):this.union_list.map(function(n,a){a==i.typeIdx&&(n.union_idx=t,n.union_duty=i.jobsArr[t].id,i.typeIdx="")})},toSelectPicker:function(n){this.typeIdx=n},toUploadImg:function(i){var t=this,a=this;n.chooseImage({count:1,sourceType:["album"],success:function(e){n.showLoading({title:"图片上传中",mask:!0});var o=e.tempFilePaths;n.uploadFile({url:a.$config.uploadImg,filePath:o[0],name:"file",success:function(e){var o=JSON.parse(e.data);0==o.code?(999==i?t.userImg=o.data:a.union_list.map(function(n,t){i==t&&(n.union_img=o.data)}),n.hideLoading()):(n.hideLoading(),a.$api.warnNotice(e.data.message))},fail:function(i){n.hideLoading(),a.$api.warnNotice("图片上传失败")}})},fail:function(n){a.$api.warnNotice("已取消上传")}})},toDeleteOthInit:function(n){this.union_list.splice(n,1)},getStartInfo:function(){var n=this,i=this;this.$api.ajax({url:this.$config.toGetStartInfo,data:{dear_id:this.id}}).then(function(t){if(200==t.statusCode&&0==t.data.code){var a=t.data.data;n.nameXing=a.surname,n.userName=a.creator.split(" | ")[0],a.creator.split(" | ")[1]&&n.jobsArr.map(function(i,t){a.creator.split(" | ")[1]==i.job&&(n.userDuty=i.id,n.jobIdx=t)}),n.userImg=a.avatar||"",n.userTel=a.tel,n.userCard=a.id_card;var e=JSON.parse(a.union_json);if(e){var o=function(n){var t=n.union_name.split(" | ")[1];if(t){var a="";return i.jobsArr.map(function(n,i){t==n.job&&(a=i)}),a}return null},u=function(n){var t=n.union_name.split(" | ")[1];if(t){var a="";return i.jobsArr.map(function(n,i){t==n.job&&(a=n.id)}),a}return""};e.map(function(i){n.union_list.push({union$name:"union$name",union$duty:"union$duty",union$tel:"union$tel",union$idCard:"union$idCard",union_idx:o(i),union_img:i.union_img||"",union_name:i.union_name.split(" | ")[0],union_duty:u(i)||"",union_tel:i.union_tel,union_idCard:i.union_idCard||""})})}}else n.$api.warnNotice(t.data.message)}).catch(function(i){console.log(i),n.$api.warnNotice("信息加载失败")})},compare:function(n){return function(i,t){var a=i[n],e=t[n];return a-e}},formSubmit:function(n){for(var i=this,t=n.detail.value,a=!0,e=Object.keys(t),o=0;o<e.length;o++)if("union"==e[o].split("$")[0]){var u=e[o].split("#")[1],r=e[o].split("#")[0];this.union_list[u]["".concat(r.split("$")[0],"_").concat(r.split("$")[1])]=t[e[o]]}if(""!=this.$api.trim(t.nameXing)){if(""==this.userImg)return void this.$api.warnNotice("您还有头像没有上传");if(""!=this.$api.trim(t.userName)){if(this.$api.inputTest(t.userTel,"tel")&&this.$api.inputTest(t.userCard,"card")){if(0!=this.union_list.length)for(var s=0;s<this.union_list.length;s++){var d=this.union_list[s];if(""==this.$api.trim(d.union_name))return a=!1,void this.$api.warnNotice("您还有联合发起人姓名未填写");if(""==d.union_duty)return a=!1,void this.$api.warnNotice("您还有职位没有选择");if(!this.$api.inputTest(d.union_tel,"tel"))return void(a=!1);if(!this.$api.inputTest(d.union_idCard,"card"))return void(a=!1);if(""==d.union_img)return a=!1,void this.$api.warnNotice("您还有头像没有上传");a=!0}if(a){var c=[];this.union_list.map(function(n,i){c.push({union_img:n.union_img,union_name:n.union_name,union_duty:n.union_duty,union_tel:n.union_tel,union_idCard:n.union_idCard})}),c.push({union_img:this.userImg,union_name:t.userName,union_duty:this.userDuty,union_tel:t.userTel,union_idCard:t.userCard}),c.sort(this.compare("union_duty")),c.map(function(n,t){i.jobsArr.map(function(i){i.id==n.union_duty&&(n.union_name="".concat(n.union_name," | ").concat(i.job))})}),t.userName=c[0].union_name,t.userTel=c[0].union_tel,t.avatar=c[0].union_img,t.userCard=c[0].union_idCard,t.union_list=c.slice(1),this.toApplyInfo(t)}}}else this.$api.warnNotice("姓名不能为空")}else this.$api.warnNotice("姓氏不能为空")},toApplyInfo:function(i){var t=this,a={creator:i.userName,tel:i.userTel,id_card:i.userCard,avatar:i.avatar||"",union_list:i.union_list||[]};"add"==this.fromType?a.surname=i.nameXing:a.dear_id=this.id;var e=this;this.$api.ajax({url:"add"==this.fromType?this.$config.createDear:this.$config.updateStartInfo,method:"add"==this.fromType?"POST":"PUT",data:a}).then(function(i){200==i.statusCode&&0==i.data.code?n.showToast({title:"操作成功",icon:"success",mask:!0,success:function(){setTimeout(function(){"add"==e.fromType?n.navigateTo({url:"/pages/apply/apply?dear_id=".concat(i.data.data,"&from=startName")}):n.navigateBack({delta:1})},1500)}}):t.$api.warnNotice(i.data.message)}).catch(function(){t.$api.warnNotice("提交失败")})},getJobs:function(){var n=this;this.$api.ajax({url:this.$config.getJobs}).then(function(i){200==i.statusCode&&0==i.data.code?(n.jobsArr=i.data.data,"edit"==n.fromType&&n.getStartInfo()):n.$api.warnNotice(i.data.message)}).catch(function(){n.$api.warnNotice("获取职称失败，请检查网络")})}}};i.default=t}).call(this,t("543d")["default"])},"89d2":function(n,i,t){"use strict";var a=t("e7ab"),e=t.n(a);e.a},"8f7f":function(n,i,t){"use strict";t.r(i);var a=t("ef7c"),e=t("56dc");for(var o in e)"default"!==o&&function(n){t.d(i,n,function(){return e[n]})}(o);t("89d2");var u=t("2877"),r=Object(u["a"])(e["default"],a["a"],a["b"],!1,null,"c8b24a30",null);i["default"]=r.exports},e7ab:function(n,i,t){},ef7c:function(n,i,t){"use strict";var a=function(){var n=this,i=n.$createElement;n._self._c},e=[];t.d(i,"a",function(){return a}),t.d(i,"b",function(){return e})}},[["1a09","common/runtime","common/vendor"]]]);